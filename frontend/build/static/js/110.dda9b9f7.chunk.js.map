{"version":3,"file":"static/js/110.dda9b9f7.chunk.js","mappings":"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","sources":["components/TemplateCard.jsx","components/TemplateGallery.jsx","services/templateLoader.js","pages/Dashboard.jsx"],"sourcesContent":["import React from 'react';\nimport { Card, CardMedia, CardContent, Typography, Box, Chip, CardActions, Button } from '@mui/material';\n\nexport function TemplateCard({ template, onSelect }) {\n  const handleSelect = (e) => {\n    e.stopPropagation(); // Prevent any double-triggering\n    onSelect();\n  };\n\n  return (\n    <Card\n      sx={{ cursor: 'pointer', transition: 'transform 0.2s', '&:hover': { transform: 'translateY(-4px)', boxShadow: 3 } }}\n    >\n      <CardMedia component=\"img\" height=\"160\" image={template.thumbnail} alt={template.name} />\n      <CardContent>\n        <Typography variant=\"h6\" gutterBottom>{template.name}</Typography>\n        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>{template.description}</Typography>\n        <Box display=\"flex\" gap={0.5} mt={1} flexWrap=\"wrap\">\n          {(template.tags || []).map(tag => (\n            <Chip key={tag} label={tag} size=\"small\" />\n          ))}\n        </Box>\n        <Box mt={1}>\n          <Chip label={template.difficulty} size=\"small\" color={template.difficulty === 'beginner' ? 'success' : (template.difficulty === 'intermediate' ? 'warning' : 'error')} />\n        </Box>\n      </CardContent>\n      <CardActions>\n        <Button size=\"small\" fullWidth variant=\"contained\" onClick={handleSelect}>Use Template</Button>\n      </CardActions>\n    </Card>\n  );\n}\n\nexport default TemplateCard;\n","import React, { useState } from 'react';\nimport { Dialog, AppBar, Toolbar, Typography, IconButton, Box, TextField, Grid, FormControl, InputLabel, Select, MenuItem } from '@mui/material';\nimport CloseIcon from '@mui/icons-material/Close';\nimport SearchIcon from '@mui/icons-material/Search';\nimport TemplateCard from './TemplateCard';\nimport { TEMPLATE_LIBRARY } from '../data/templates';\n\nexport function TemplateGallery({ onSelectTemplate, onClose }) {\n  const [category, setCategory] = useState('all');\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const filteredTemplates = TEMPLATE_LIBRARY.filter(template => {\n    const matchesCategory = category === 'all' || template.category === category;\n    const q = (searchQuery || '').toLowerCase();\n    const matchesSearch = !q || template.name.toLowerCase().includes(q) || (template.tags || []).some(t => t.includes(q));\n    return matchesCategory && matchesSearch;\n  });\n\n  return (\n    <Dialog open fullScreen onClose={onClose}>\n      <AppBar position=\"static\">\n        <Toolbar>\n          <Typography variant=\"h6\" sx={{ flexGrow: 1 }}>Choose a Template</Typography>\n          <IconButton color=\"inherit\" onClick={onClose}><CloseIcon /></IconButton>\n        </Toolbar>\n      </AppBar>\n      <Box p={3}>\n        <Box display=\"flex\" gap={2} mb={3}>\n          <TextField fullWidth placeholder=\"Search templates...\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} InputProps={{ startAdornment: <SearchIcon /> }} />\n          <FormControl sx={{ minWidth: 200 }}>\n            <InputLabel>Category</InputLabel>\n            <Select value={category} onChange={(e) => setCategory(e.target.value)}>\n              <MenuItem value=\"all\">All Categories</MenuItem>\n              <MenuItem value=\"business\">Business</MenuItem>\n              <MenuItem value=\"design\">Design</MenuItem>\n              <MenuItem value=\"education\">Education</MenuItem>\n              <MenuItem value=\"engineering\">Engineering</MenuItem>\n              <MenuItem value=\"games\">Games</MenuItem>\n            </Select>\n          </FormControl>\n        </Box>\n\n        <Grid container spacing={3}>\n          {filteredTemplates.map(t => (\n            <Grid item xs={12} sm={6} md={4} lg={3} key={t.id}>\n              <TemplateCard template={t} onSelect={() => onSelectTemplate(t)} />\n            </Grid>\n          ))}\n        </Grid>\n\n        {filteredTemplates.length === 0 && (\n          <Box textAlign=\"center\" py={8}><Typography variant=\"h6\" color=\"textSecondary\">No templates found</Typography></Box>\n        )}\n      </Box>\n    </Dialog>\n  );\n}\n\nexport default TemplateGallery;\n","import { TEMPLATE_LIBRARY } from '../data/templates';\nimport { createRoom } from '../api/rooms';\nimport { getAuthToken } from '../utils/authUtils';\n\nexport class TemplateLoader {\n  static async loadTemplate(templateId, canvas) {\n    const template = TEMPLATE_LIBRARY.find(t => t.id === templateId);\n    if (!template) throw new Error('Template not found');\n\n    // Clear canvas if API is provided\n    if (canvas && typeof canvas.clear === 'function') canvas.clear();\n\n    if (canvas && typeof canvas.setSize === 'function' && template.canvas) {\n      canvas.setSize(template.canvas.width, template.canvas.height);\n      if (typeof canvas.setBackground === 'function') canvas.setBackground(template.canvas.background);\n    }\n\n    // Add provided objects if canvas API supports addObject\n    if (canvas && template.canvas && Array.isArray(template.canvas.objects)) {\n      for (const obj of template.canvas.objects) {\n        if (typeof canvas.addObject === 'function') {\n          try { await canvas.addObject(obj); } catch (e) { /* best-effort */ }\n        }\n      }\n    }\n\n    if (canvas && typeof canvas.zoomToFit === 'function') canvas.zoomToFit();\n    return template;\n  }\n\n  // Create a new room based on template (MVP: creates room and returns its id)\n  static async createFromTemplate(templateId, token) {\n    const template = TEMPLATE_LIBRARY.find(t => t.id === templateId);\n    if (!template) throw new Error('Template not found');\n\n    const name = `${template.name} - ${new Date().toLocaleDateString()}`;\n    // Use existing createRoom API to create a room with template_id\n    const tkn = token || getAuthToken();\n    const room = await createRoom(tkn, { name, type: 'private', template_id: templateId });\n    return room;\n  }\n}\n\nexport default TemplateLoader;\n","import React, { useEffect, useState, useMemo, useRef, useCallback } from 'react';\nimport { Box, Button, Paper, Typography, Stack, Chip, Dialog, DialogTitle, DialogContent, TextField, DialogActions, Divider, CircularProgress, Tooltip, MenuItem, Pagination, IconButton } from '@mui/material';\nimport ArrowUpwardIcon from '@mui/icons-material/ArrowUpward';\nimport ArrowDownwardIcon from '@mui/icons-material/ArrowDownward';\nimport GroupIcon from '@mui/icons-material/Group';\nimport CalendarTodayIcon from '@mui/icons-material/CalendarToday';\nimport EditIcon from '@mui/icons-material/Edit';\nimport SortByAlphaIcon from '@mui/icons-material/SortByAlpha';\nimport SafeSnackbar from '../components/SafeSnackbar';\nimport Autocomplete from '@mui/material/Autocomplete';\nimport TemplateGallery from '../components/TemplateGallery';\nimport TemplateLoader from '../services/templateLoader';\nimport { listRooms, createRoom, shareRoom, listInvites, acceptInvite, declineInvite, updateRoom, suggestUsers, suggestRooms, getRoomMembers } from '../api/rooms';\nimport { getUsername } from '../utils/getUsername';\nimport { useNavigate, Link } from 'react-router-dom';\nimport RouterLinkWrapper from '../components/RouterLinkWrapper';\nimport { handleAuthError } from '../utils/authUtils';\nimport { formatErrorMessage, clientValidation } from '../utils/errorHandling';\nimport { getSocket, setSocketToken } from '../services/socket';\n\nexport default function Dashboard({ auth }) {\n  const nav = useNavigate();\n  const creatingTemplateRef = useRef(false); // Prevent double-click on template selection\n  const [rooms, setRooms] = useState([]);\n  const [archivedRooms, setArchivedRooms] = useState([]);\n  const [invites, setInvites] = useState([]);\n  const [openCreate, setOpenCreate] = useState(false);\n  const [showTemplates, setShowTemplates] = useState(false);\n  const [newName, setNewName] = useState('');\n  const [newType, setNewType] = useState('public');\n  const [shareOpen, setShareOpen] = useState(null); // roomId\n  // shareUsers holds objects: { username: 'alice', role: 'editor' }\n  const [shareUsers, setShareUsers] = useState([]);\n\n  const [shareSelectedSuggestions, setShareSelectedSuggestions] = useState([]);\n  const [shareInputValue, setShareInputValue] = useState('');\n  const [suggestOpen, setSuggestOpen] = useState(false);\n  const [suggestOptions, setSuggestOptions] = useState([]);\n  const [suggestLoading, setSuggestLoading] = useState(false);\n\n  const [roomSearchValue, setRoomSearchValue] = useState('');\n  const [roomSuggestOpen, setRoomSuggestOpen] = useState(false);\n  const [roomSuggestOptions, setRoomSuggestOptions] = useState([]);\n  const [roomSuggestLoading, setRoomSuggestLoading] = useState(false);\n  const [membersCache, setMembersCache] = useState({}); // roomId -> { loading, members }\n  const [shareErrors, setShareErrors] = useState([]);\n  const [shareSuccess, setShareSuccess] = useState({ open: false, message: '' });\n  const [shareLinkOpen, setShareLinkOpen] = useState(null); // roomId for link dialog\n  const [confirmLeaveOpen, setConfirmLeaveOpen] = useState(null); // roomId pending leave\n  const [confirmArchiveOpen, setConfirmArchiveOpen] = useState(null); // roomId pending archive (owner)\n  const [confirmUnarchiveOpen, setConfirmUnarchiveOpen] = useState(null); // roomId pending unarchive (owner)\n\n  const [confirmDestructiveOpen, setConfirmDestructiveOpen] = useState(null); // owner-only permanent delete\n  const [destructiveConfirmText, setDestructiveConfirmText] = useState('');\n  const [snack, setSnack] = useState({ open: false, message: '' });\n\n  const [publicSortKey, setPublicSortKey] = useState(() => localStorage.getItem('rescanvas:publicSortKey') || 'updatedAt');\n  const [publicSortOrder, setPublicSortOrder] = useState(() => localStorage.getItem('rescanvas:publicSortOrder') || 'desc');\n  const [privateSortKey, setPrivateSortKey] = useState(() => localStorage.getItem('rescanvas:privateSortKey') || 'updatedAt');\n  const [privateSortOrder, setPrivateSortOrder] = useState(() => localStorage.getItem('rescanvas:privateSortOrder') || 'desc');\n  const [secureSortKey, setSecureSortKey] = useState(() => localStorage.getItem('rescanvas:secureSortKey') || 'updatedAt');\n  const [secureSortOrder, setSecureSortOrder] = useState(() => localStorage.getItem('rescanvas:secureSortOrder') || 'desc');\n  const [archivedSortKey, setArchivedSortKey] = useState(() => localStorage.getItem('rescanvas:archivedSortKey') || 'updatedAt');\n  const [archivedSortOrder, setArchivedSortOrder] = useState(() => localStorage.getItem('rescanvas:archivedSortOrder') || 'desc');\n  const sortKey = publicSortKey;\n  const sortOrder = publicSortOrder;\n\n  const [publicPage, setPublicPage] = useState(1);\n  const [privatePage, setPrivatePage] = useState(1);\n  const [securePage, setSecurePage] = useState(1);\n  const [publicPerPage, setPublicPerPage] = useState(() => Number(localStorage.getItem('rescanvas:publicPerPage')) || 20);\n  const [privatePerPage, setPrivatePerPage] = useState(() => Number(localStorage.getItem('rescanvas:privatePerPage')) || 20);\n  const [securePerPage, setSecurePerPage] = useState(() => Number(localStorage.getItem('rescanvas:securePerPage')) || 20);\n  const [publicTotal, setPublicTotal] = useState(0);\n  const [privateTotal, setPrivateTotal] = useState(0);\n  const [secureTotal, setSecureTotal] = useState(0);\n\n  const [archivedPage, setArchivedPage] = useState(1);\n  const [archivedPerPage, setArchivedPerPage] = useState(() => Number(localStorage.getItem('rescanvas:archivedPerPage')) || 20);\n  const [archivedTotal, setArchivedTotal] = useState(0);\n\n  // Debounced user search for better performance\n  const userSearchTimeoutRef = useRef(null);\n  const debouncedUserSearch = useCallback((value) => {\n    if (userSearchTimeoutRef.current) {\n      clearTimeout(userSearchTimeoutRef.current);\n    }\n    \n    if (!value || value.length < 2) {\n      setSuggestOptions([]);\n      return;\n    }\n    \n    setSuggestLoading(true);\n    userSearchTimeoutRef.current = setTimeout(async () => {\n      try {\n        const opts = await suggestUsers(auth.token, value);\n        setSuggestOptions(opts || []);\n      } catch (err) {\n        console.warn('suggestUsers failed', err);\n        setSuggestOptions([]);\n      } finally {\n        setSuggestLoading(false);\n      }\n    }, 300); // 300ms debounce delay\n  }, [auth.token]);\n\n  // Debounced room search for better performance\n  const roomSearchTimeoutRef = useRef(null);\n  const debouncedRoomSearch = useCallback((value) => {\n    if (roomSearchTimeoutRef.current) {\n      clearTimeout(roomSearchTimeoutRef.current);\n    }\n    \n    if (!value || value.length < 2) {\n      setRoomSuggestOptions([]);\n      return;\n    }\n    \n    setRoomSuggestLoading(true);\n    roomSearchTimeoutRef.current = setTimeout(async () => {\n      try {\n        const opts = await suggestRooms(auth.token, value);\n        setRoomSuggestOptions(opts || []);\n      } catch (err) {\n        console.warn('suggestRooms failed', err);\n        setRoomSuggestOptions([]);\n      } finally {\n        setRoomSuggestLoading(false);\n      }\n    }, 300); // 300ms debounce delay\n  }, [auth.token]);\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (userSearchTimeoutRef.current) clearTimeout(userSearchTimeoutRef.current);\n      if (roomSearchTimeoutRef.current) clearTimeout(roomSearchTimeoutRef.current);\n    };\n  }, []);\n\n  async function refresh() {\n    if (!auth?.token) return;\n    try {\n      const pubP = listRooms(auth.token, { includeArchived: false, sortBy: publicSortKey, order: publicSortOrder, page: publicPage, per_page: publicPerPage, type: 'public' });\n      const priP = listRooms(auth.token, { includeArchived: false, sortBy: privateSortKey, order: privateSortOrder, page: privatePage, per_page: privatePerPage, type: 'private' });\n      const secP = listRooms(auth.token, { includeArchived: false, sortBy: secureSortKey, order: secureSortOrder, page: securePage, per_page: securePerPage, type: 'secure' });\n      const archivedP = listRooms(auth.token, { includeArchived: true, sortBy: archivedSortKey, order: archivedSortOrder, page: archivedPage, per_page: archivedPerPage });\n\n      const [pubRes, priRes, secRes, archivedRes] = await Promise.all([pubP, priP, secP, archivedP]);\n\n      const pubRooms = pubRes?.rooms || [];\n      const priRooms = priRes?.rooms || [];\n      const secRooms = secRes?.rooms || [];\n      const archivedAll = archivedRes?.rooms || [];\n\n      // Trust server-side visibility and archived filtering. Backend now\n      // returns only the requested visibility set (archived vs active), so\n      // avoid additional client-side filtering which caused mismatches.\n      const visiblePublic = pubRooms;\n      const visiblePrivate = priRooms;\n      const visibleSecure = secRooms;\n      const visibleArchived = archivedAll;\n\n      // Update section states\n      // Combine section arrays but deduplicate by room id to avoid duplicate React keys\n      const combined = [...visiblePublic, ...visiblePrivate, ...visibleSecure];\n      const dedupMap = new Map();\n      for (const r of combined) {\n        if (!r || !r.id) continue;\n        if (!dedupMap.has(r.id)) dedupMap.set(r.id, r);\n      }\n      const dedupedRooms = Array.from(dedupMap.values());\n      setRooms(dedupedRooms);\n      // Prefer server-provided totals (for correct pagination). Fall back to visible lengths.\n      setPublicTotal((pubRes && typeof pubRes.total === 'number') ? pubRes.total : pubRooms.length);\n      setPrivateTotal((priRes && typeof priRes.total === 'number') ? priRes.total : priRooms.length);\n      setSecureTotal((secRes && typeof secRes.total === 'number') ? secRes.total : secRooms.length);\n      setArchivedRooms(visibleArchived);\n      setArchivedTotal((archivedRes && typeof archivedRes.total === 'number') ? archivedRes.total : archivedAll.length);\n\n      setInvites(await listInvites(auth.token));\n    } catch (error) {\n      console.error('Dashboard refresh failed:', error);\n      handleAuthError(error);\n    }\n  }\n  useEffect(() => { refresh(); }, [auth?.token]);\n  useEffect(() => { refresh(); }, [publicSortKey, publicSortOrder, privateSortKey, privateSortOrder, secureSortKey, secureSortOrder, archivedSortKey, archivedSortOrder, publicPage, privatePage, securePage, archivedPage, publicPerPage, privatePerPage, securePerPage, archivedPerPage]);\n  useEffect(() => {\n    function onRoomsUpdated() { refresh(); }\n    window.addEventListener('rescanvas:rooms-updated', onRoomsUpdated);\n    return () => window.removeEventListener('rescanvas:rooms-updated', onRoomsUpdated);\n  }, []);\n\n  // Socket.IO listener for real-time dashboard updates\n  useEffect(() => {\n    if (!auth?.token) return;\n\n    try {\n      setSocketToken(auth.token);\n      const sock = getSocket(auth.token);\n\n      const onRoomAccessGranted = (payload) => {\n        console.log('Room access granted:', payload);\n        setSnack({ open: true, message: `You were added to room: ${payload.roomName || 'a room'}` });\n        refresh();\n      };\n\n      const onUserRemovedFromRoom = (payload) => {\n        console.log('User removed from room:', payload);\n        setSnack({ open: true, message: payload.message || 'You were removed from a room' });\n        refresh();\n      };\n\n      const onRoomDeleted = (payload) => {\n        console.log('Room deleted:', payload);\n        setSnack({ open: true, message: 'A room was deleted' });\n        refresh();\n      };\n\n      const onInviteReceived = (payload) => {\n        console.log('Invite received:', payload);\n        setSnack({ open: true, message: `You were invited to room: ${payload.roomName || 'a room'}` });\n        // Refresh invites list immediately\n        listInvites(auth.token).then(inv => setInvites(inv)).catch(err => console.error('Failed to refresh invites:', err));\n      };\n\n      const onInviteAccepted = (payload) => {\n        console.log('Invite accepted:', payload);\n        // Remove from pending invites list immediately\n        setInvites(prev => prev.filter(inv => inv.id !== payload.inviteId));\n      };\n\n      const onInviteDeclined = (payload) => {\n        console.log('Invite declined:', payload);\n        // Remove from pending invites list immediately\n        setInvites(prev => prev.filter(inv => inv.id !== payload.inviteId));\n      };\n\n      sock.on('room_access_granted', onRoomAccessGranted);\n      sock.on('user_removed_from_room', onUserRemovedFromRoom);\n      sock.on('room_deleted', onRoomDeleted);\n      sock.on('invite_received', onInviteReceived);\n      sock.on('invite_accepted', onInviteAccepted);\n      sock.on('invite_declined', onInviteDeclined);\n\n      return () => {\n        try {\n          sock.off('room_access_granted', onRoomAccessGranted);\n          sock.off('user_removed_from_room', onUserRemovedFromRoom);\n          sock.off('room_deleted', onRoomDeleted);\n          sock.off('invite_received', onInviteReceived);\n          sock.off('invite_accepted', onInviteAccepted);\n          sock.off('invite_declined', onInviteDeclined);\n        } catch (e) { }\n      };\n    } catch (e) {\n      console.error('Failed to setup socket listeners:', e);\n    }\n  }, [auth?.token]);\n\n  // Persist sort preferences\n  useEffect(() => {\n    try { localStorage.setItem('rescanvas:publicSortKey', publicSortKey); } catch (e) { }\n    try { localStorage.setItem('rescanvas:publicSortOrder', publicSortOrder); } catch (e) { }\n    try { localStorage.setItem('rescanvas:privateSortKey', privateSortKey); } catch (e) { }\n    try { localStorage.setItem('rescanvas:privateSortOrder', privateSortOrder); } catch (e) { }\n    try { localStorage.setItem('rescanvas:secureSortKey', secureSortKey); } catch (e) { }\n    try { localStorage.setItem('rescanvas:secureSortOrder', secureSortOrder); } catch (e) { }\n    try { localStorage.setItem('rescanvas:archivedSortKey', archivedSortKey); } catch (e) { }\n    try { localStorage.setItem('rescanvas:archivedSortOrder', archivedSortOrder); } catch (e) { }\n    try { localStorage.setItem('rescanvas:publicPerPage', String(publicPerPage)); } catch (e) { }\n    try { localStorage.setItem('rescanvas:privatePerPage', String(privatePerPage)); } catch (e) { }\n    try { localStorage.setItem('rescanvas:securePerPage', String(securePerPage)); } catch (e) { }\n    try { localStorage.setItem('rescanvas:archivedPerPage', String(archivedPerPage)); } catch (e) { }\n  }, [publicSortKey, publicSortOrder, privateSortKey, privateSortOrder, secureSortKey, secureSortOrder, archivedSortKey, archivedSortOrder, publicPerPage, privatePerPage, securePerPage, archivedPerPage]);\n\n  async function doCreate() {\n    // Client-side validation\n    const nameError = clientValidation.roomName(newName);\n    if (nameError) {\n      setSnack({ open: true, message: nameError });\n      return;\n    }\n\n    const typeError = clientValidation.roomType(newType);\n    if (typeError) {\n      setSnack({ open: true, message: typeError });\n      return;\n    }\n\n    try {\n      const r = await createRoom(auth.token, { name: newName, type: newType });\n      setOpenCreate(false); setNewName('');\n      await refresh();\n      nav(`/rooms/${r.id}`);\n    } catch (error) {\n      const errorMessage = formatErrorMessage(error);\n      setSnack({ open: true, message: errorMessage });\n    }\n  }\n\n  async function doShare() {\n    // shareUsers is an array of { username, role }\n    let users = Array.isArray(shareUsers) ? shareUsers.slice() : [];\n    if (shareInputValue && typeof shareInputValue === 'string' && shareInputValue.trim()) {\n      users = [...users, { username: shareInputValue.trim(), role: 'editor' }];\n    }\n    try {\n      const resp = await shareRoom(auth.token, shareOpen, users);\n      // If server returned errors, surface them instead of silently closing\n      const res = (resp && resp.results) || {};\n      const errors = res.errors || [];\n      const invited = (res.invited || []).map(i => i.username);\n      const updated = (res.updated || []).map(i => i.username);\n      const succeeded = [...invited, ...updated];\n      if (errors && errors.length) {\n        setShareErrors(errors);\n        // show success for any usernames that succeeded while leaving dialog open for errors\n        if (succeeded.length) {\n          setShareSuccess({ open: true, message: `Shared with ${succeeded.join(', ')}` });\n        }\n        return;\n      }\n      // No errors -> fully successful share\n      if (succeeded.length) {\n        setShareSuccess({ open: true, message: `Shared with ${succeeded.join(', ')}` });\n      }\n      setShareOpen(null); setShareUsers([]); setShareErrors([]); setShareInputValue('');\n      await refresh();\n    } catch (e) {\n      console.error('Share failed', e);\n      const errorMessage = formatErrorMessage(e);\n      setSnack({ open: true, message: errorMessage });\n    }\n  }\n\n  // Only allow sharing when at least one of the selected users matches an actual suggestion option\n  const canShare = Array.isArray(shareUsers) && (shareUsers || []).some(u => {\n    const uname = (u && (u.username || u)) || '';\n    return (suggestOptions || []).some(opt => ((opt && (opt.username || opt)) === uname));\n  });\n\n  const handleShareLink = (roomId) => {\n    setShareLinkOpen(roomId);\n  };\n\n  function Section({ title, items, page = 1, perPage = 20, total = 0, onPageChange, onPerPageChange, sortKey, sortOrder, onSortKeyChange, onSortOrderToggle }) {\n    // show section even if empty so users can change pagination\n    const allowedPageSizes = [10, 20, 50, 100];\n    const safePerPage = allowedPageSizes.includes(perPage) ? perPage : 20;\n    const safePage = (typeof page === 'number' && page > 0) ? page : 1;\n    const safeTotal = (typeof total === 'number') ? total : 0;\n    const handlePerPage = typeof onPerPageChange === 'function' ? onPerPageChange : (() => { });\n    const handlePage = typeof onPageChange === 'function' ? onPageChange : (() => { });\n\n    // compute a clear page range label like \"110 of 11\" instead of confusing\n    // \"10 / 11 visible\" which mixes page size with total counts.\n    const startIndex = (typeof safeTotal === 'number' && safeTotal > 0) ? ((safePage - 1) * safePerPage) + 1 : 0;\n    const endIndex = (typeof safeTotal === 'number' && safeTotal > 0) ? Math.min(safeTotal, safePage * safePerPage) : 0;\n    const pageRangeLabel = (safeTotal > 0) ? `${startIndex}${startIndex === endIndex ? '' : '' + endIndex} of ${safeTotal}` : `${safeTotal} total`;\n\n    return (\n      <Box>\n        <Stack direction=\"row\" alignItems=\"center\" spacing={1} sx={{ mb: 0.5 }}>\n          <Typography variant=\"overline\" sx={{ opacity: 0.7 }}>{title}</Typography>\n          <Box sx={{ flex: 1 }} />\n          {typeof safeTotal === 'number' && (\n            <Typography variant=\"caption\" color=\"text.secondary\">\n              {pageRangeLabel}\n            </Typography>\n          )}\n\n          {/* per-section sort controls */}\n          <Typography variant=\"caption\" sx={{ opacity: 0.7, ml: 1 }}>Sort:</Typography>\n          <TextField\n            size=\"small\"\n            select\n            value={sortKey}\n            onChange={(e) => onSortKeyChange && onSortKeyChange(e.target.value)}\n            sx={{ minWidth: 180, ml: 0.5 }}\n          >\n            <MenuItem value=\"updatedAt\"><Stack direction=\"row\" spacing={1} alignItems=\"center\"><EditIcon fontSize=\"small\" /> <Typography variant=\"body2\">Last edited</Typography></Stack></MenuItem>\n            <MenuItem value=\"createdAt\"><Stack direction=\"row\" spacing={1} alignItems=\"center\"><CalendarTodayIcon fontSize=\"small\" /> <Typography variant=\"body2\">Created</Typography></Stack></MenuItem>\n            <MenuItem value=\"name\"><Stack direction=\"row\" spacing={1} alignItems=\"center\"><SortByAlphaIcon fontSize=\"small\" /> <Typography variant=\"body2\">Name (A  Z)</Typography></Stack></MenuItem>\n            <MenuItem value=\"memberCount\"><Stack direction=\"row\" spacing={1} alignItems=\"center\"><GroupIcon fontSize=\"small\" /> <Typography variant=\"body2\">Members</Typography></Stack></MenuItem>\n          </TextField>\n          <IconButton size=\"small\" onClick={() => onSortOrderToggle && onSortOrderToggle()} aria-label=\"toggle-sort-order\">\n            {sortOrder === 'asc' ? <ArrowUpwardIcon fontSize=\"small\" /> : <ArrowDownwardIcon fontSize=\"small\" />}\n          </IconButton>\n\n          <TextField select size=\"small\" value={String(safePerPage)} onChange={(e) => handlePerPage(Number(e.target.value))} sx={{ width: 110, ml: 1 }}>\n            <MenuItem value={10}>10 / page</MenuItem>\n            <MenuItem value={20}>20 / page</MenuItem>\n            <MenuItem value={50}>50 / page</MenuItem>\n            <MenuItem value={100}>100 / page</MenuItem>\n          </TextField>\n          <Pagination count={Math.max(1, Math.ceil((safeTotal || 0) / safePerPage))} page={safePage} onChange={(e, v) => handlePage(v)} size=\"small\" sx={{ ml: 1 }} />\n        </Stack>\n        <Stack sx={{ mt: 0.5 }} spacing={0.5}>\n          {items.map(r => {\n            const isOwner = (() => {\n              if (r.myRole === 'owner') return true;\n              try {\n                const uname = getUsername(auth);\n                return !!(uname && r.ownerName && uname === r.ownerName);\n              } catch (e) { return false; }\n            })();\n            return (\n              <Paper key={r.id} sx={{ p: 1, display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: 0.5 }}>\n                <Box sx={{ flex: 1, minWidth: '200px' }}>\n                  <Typography variant=\"subtitle2\" component={RouterLinkWrapper} to={`/rooms/${r.id}`} style={{ textDecoration: 'none' }}>{r.name}</Typography>\n                  <Stack direction=\"row\" spacing={0.5} sx={{ mt: 0.25, flexWrap: 'wrap' }}>\n                    <Chip size=\"small\" label={r.type} sx={{ fontSize: '0.7rem' }} />\n                    <Tooltip\n                      title={(membersCache[r.id] && membersCache[r.id].members && membersCache[r.id].members.length) ? (\n                        <Box>\n                          {(membersCache[r.id].members || []).map((m, i) => (\n                            <Typography key={i} variant=\"body2\">{m && m.username ? m.username : String(m)}</Typography>\n                          ))}\n                        </Box>\n                      ) : (membersCache[r.id] && membersCache[r.id].loading ? 'Loading...' : 'No members listed')}\n                      onOpen={async () => {\n                        if (!r.id) return;\n                        if (membersCache[r.id]) return; // already loaded or loading\n                        setMembersCache(prev => ({ ...prev, [r.id]: { loading: true, members: [] } }));\n                        try {\n                          const ms = await getRoomMembers(auth.token, r.id);\n                          setMembersCache(prev => ({ ...prev, [r.id]: { loading: false, members: ms || [] } }));\n                        } catch (e) {\n                          setMembersCache(prev => ({ ...prev, [r.id]: { loading: false, members: [] } }));\n                        }\n                      }}\n                    >\n                      <Chip size=\"small\" label={`${r.memberCount} member${r.memberCount !== 1 ? 's' : ''}`} sx={{ fontSize: '0.7rem' }} />\n                    </Tooltip>\n                    {r.ownerName && <Chip size=\"small\" label={`owner: ${r.ownerName}`} sx={{ fontSize: '0.7rem' }} />}\n                    {/* retention feature removed */}\n                  </Stack>\n                  {/* Show description if provided */}\n                  {r.description && (\n                    <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mt: 0.5, wordBreak: 'break-word' }}>{r.description}</Typography>\n                  )}\n                  {/* created/updated timestamps */}\n                  <Stack direction=\"row\" spacing={1} sx={{ mt: 0.5, alignItems: 'center', flexWrap: 'wrap' }}>\n                    {r.updatedAt && <Typography variant=\"caption\" color=\"text.secondary\">Last edited: {new Date(r.updatedAt).toLocaleString()}</Typography>}\n                    {r.createdAt && <Typography variant=\"caption\" color=\"text.secondary\">Created: {new Date(r.createdAt).toLocaleString()}</Typography>}\n                  </Stack>\n                </Box>\n                <Stack direction=\"row\" spacing={0.5} sx={{ flexShrink: 0 }}>\n                  {/* Archived rooms are view-only; only owner can unarchive */}\n                  {r.archived ? (\n                    <>\n                      <Button size=\"small\" component={RouterLinkWrapper} to={`/rooms/${r.id}`}>View</Button>\n                      {isOwner ? (\n                        <>\n                          <Button size=\"small\" color=\"primary\" onClick={() => setConfirmUnarchiveOpen(r.id)}>Unarchive</Button>\n                          <Button size=\"small\" color=\"error\" onClick={() => setConfirmDestructiveOpen(r.id)}>Delete (permanent)</Button>\n                        </>\n                      ) : (\n                        <>\n                          <Button size=\"small\" color=\"error\" onClick={() => setConfirmLeaveOpen(r.id)}>Leave</Button>\n                        </>\n                      )}\n                    </>\n                  ) : (\n                    <>\n                      {r.type === 'public' ? (\n                        <Button size=\"small\" onClick={() => setShareLinkOpen(r.id)}>Share link</Button>\n                      ) : (\n                        <Button size=\"small\" onClick={() => setShareOpen(r.id)}>Share</Button>\n                      )}\n                      {!isOwner ? (\n                        <Button size=\"small\" color=\"error\" onClick={() => setConfirmLeaveOpen(r.id)}>Leave</Button>\n                      ) : (\n                        <Button size=\"small\" color=\"error\" onClick={() => setConfirmArchiveOpen(r.id)}>Archive</Button>\n                      )}\n                    </>\n                  )}\n                </Stack>\n              </Paper>\n            )\n          })}\n        </Stack>\n      </Box>\n    );\n  }\n\n  const grouped = {\n    public: rooms.filter(r => r.type === 'public'),\n    private: rooms.filter(r => r.type === 'private'),\n    secure: rooms.filter(r => r.type === 'secure'),\n    // archivedRooms is provided by the server and already contains only archived entries\n    archived: archivedRooms\n  };\n  // server-side sorted groups are provided by API; use grouped directly\n  const groupedSorted = grouped;\n\n  return (\n    <Box sx={{\n      minHeight: 0,\n      p: 1.5,\n      display: 'grid',\n      gap: 1.5\n    }}>\n      <Typography variant=\"h5\">Dashboard</Typography>\n\n      {/* Actions */}\n      <Stack direction=\"row\" spacing={0.75} flexWrap=\"wrap\">\n        <Button variant=\"contained\" size=\"small\" onClick={() => { setNewType('public'); setOpenCreate(true); }}>New Public</Button>\n        <Button variant=\"contained\" size=\"small\" onClick={() => { setNewType('private'); setOpenCreate(true); }}>New Private</Button>\n        <Button variant=\"contained\" size=\"small\" onClick={() => { setNewType('secure'); setOpenCreate(true); }}>New Secure</Button>\n        <Button variant=\"outlined\" size=\"small\" onClick={() => setShowTemplates(true)}>Templates</Button>\n      </Stack>\n\n      {showTemplates && (\n        <TemplateGallery onClose={() => setShowTemplates(false)} onSelectTemplate={async (template) => {\n          // Prevent double-click/double-trigger\n          if (creatingTemplateRef.current) {\n            console.log('[Template] Already creating template, ignoring duplicate call');\n            return;\n          }\n\n          creatingTemplateRef.current = true;\n          try {\n            console.log('[Template] Creating room from template:', template.id);\n            // Create a new private room from the template (MVP). server may ignore template payload.\n            const created = await TemplateLoader.createFromTemplate(template.id, auth?.token);\n            if (created && created.id) {\n              setShowTemplates(false);\n              nav(`/rooms/${created.id}`);\n            }\n          } catch (e) {\n            console.error('Create from template failed', e);\n\n            if (e.response && e.response.status === 429) {\n              const errorMsg = e.body?.message || \"You've reached the limit for room creation. Please try again later.\";\n              console.warn('[Template] Rate limit exceeded:', errorMsg);\n              setSnack({ open: true, message: errorMsg });\n              setShowTemplates(false);\n            } else {\n              setShowTemplates(false);\n            }\n          } finally {\n            setTimeout(() => {\n              creatingTemplateRef.current = false;\n            }, 1000);\n          }\n        }} />\n      )}\n\n\n\n\n\n      {/* Public room search */}\n      <Box sx={{ mt: 1, maxWidth: 560 }}>\n        <Autocomplete\n          freeSolo\n          open={roomSuggestOpen}\n          onOpen={() => setRoomSuggestOpen(true)}\n          onClose={() => setRoomSuggestOpen(false)}\n          options={roomSuggestOptions}\n          getOptionLabel={(opt) => typeof opt === 'string' ? opt : (opt.name || '')}\n          onInputChange={(e, newInput) => {\n            setRoomSearchValue(newInput);\n            debouncedRoomSearch(newInput);\n          }}\n          loading={roomSuggestLoading}\n          onChange={(e, newValue) => {\n            // If user selected a room object, navigate to it\n            if (newValue && typeof newValue === 'object' && newValue.id) {\n              nav(`/rooms/${newValue.id}`);\n            } else if (typeof newValue === 'string' && newValue.trim()) {\n              // If they typed a full room id or name, try to find exact match in suggestions\n              const match = (roomSuggestOptions || []).find(r => r.name === newValue || r.id === newValue);\n              if (match && match.id) nav(`/rooms/${match.id}`);\n            }\n            setRoomSearchValue('');\n            setRoomSuggestOptions([]);\n            setRoomSuggestOpen(false);\n          }}\n          renderInput={(params) => {\n            const { ownerState, sx, className, ...safeParams } = params || {};\n            return (\n              <TextField\n                {...safeParams}\n                label=\"Search public rooms\"\n                placeholder=\"Type to find public rooms\"\n                InputProps={{\n                  ...safeParams.InputProps,\n                  endAdornment: (\n                    <>\n                      {roomSuggestLoading ? <CircularProgress color=\"inherit\" size={20} /> : null}\n                      {safeParams.InputProps?.endAdornment}\n                    </>\n                  )\n                }}\n              />\n            );\n          }}\n          renderOption={(props, option) => {\n            const { ownerState, sx, className, ...rest } = props || {};\n            return (\n              <li {...rest} key={option.id}>\n                <Box sx={{ display: 'flex', flexDirection: 'column' }}>\n                  <Typography variant=\"body2\">{option.name}</Typography>\n                  <Typography variant=\"caption\" color=\"text.secondary\">{option.ownerName || ''}  {option.memberCount || 0} members</Typography>\n                </Box>\n              </li>\n            );\n          }}\n        />\n      </Box>\n\n      {/* Pending invites */}\n      <Box>\n        <Typography variant=\"overline\" sx={{ opacity: 0.7 }}>Pending Invites</Typography>\n        <Stack sx={{ mt: 0.5 }} spacing={0.5}>\n          {invites.length === 0 && <Typography variant=\"body2\" color=\"text.secondary\">None</Typography>}\n          {invites.map(inv => (\n            <Paper key={inv.id} sx={{ p: 1, display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: 0.5 }}>\n              <Box sx={{ flex: 1, minWidth: '200px' }}>\n                <Typography variant=\"subtitle2\" sx={{ wordBreak: 'break-word' }}>{inv.roomName}</Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ wordBreak: 'break-word' }}>\n                  Invited by {inv.inviterName} as {inv.role}\n                </Typography>\n              </Box>\n              <Stack direction=\"row\" spacing={0.5} sx={{ flexShrink: 0 }}>\n                <Button variant=\"contained\" size=\"small\" onClick={async () => {\n                  try {\n                    await acceptInvite(auth.token, inv.id);\n                  } catch (e) {\n                    // If invite was already accepted or removed, refresh to clear stale UI\n                    if (e?.message && e.message.includes('Invite not pending')) {\n                      console.warn('Invite race: not pending, refreshing invites');\n                    } else {\n                      console.error('Accept invite failed', e);\n                    }\n                  } finally {\n                    await refresh();\n                  }\n                }}>Accept</Button>\n                <Button size=\"small\" onClick={async () => {\n                  try {\n                    await declineInvite(auth.token, inv.id);\n                  } catch (e) {\n                    // If invite already removed, just refresh\n                    console.warn('Decline invite error (ignored):', e?.message || e);\n                  } finally {\n                    await refresh();\n                  }\n                }}>Decline</Button>\n              </Stack>\n            </Paper>\n          ))}\n        </Stack>\n      </Box>\n\n      <Divider />\n\n      {/* Rooms by type */}\n      <Section\n        title=\"Public Rooms\"\n        items={groupedSorted.public}\n        page={publicPage}\n        perPage={publicPerPage}\n        total={publicTotal}\n        onPageChange={(v) => setPublicPage(v)}\n        onPerPageChange={(v) => { setPublicPerPage(v); setPublicPage(1); }}\n        sortKey={publicSortKey}\n        sortOrder={publicSortOrder}\n        onSortKeyChange={(k) => { setPublicSortKey(k); setPublicPage(1); }}\n        onSortOrderToggle={() => { setPublicSortOrder(o => o === 'asc' ? 'desc' : 'asc'); setPublicPage(1); }}\n      />\n      <Section\n        title=\"Private Rooms\"\n        items={groupedSorted.private}\n        page={privatePage}\n        perPage={privatePerPage}\n        total={privateTotal}\n        onPageChange={(v) => setPrivatePage(v)}\n        onPerPageChange={(v) => { setPrivatePerPage(v); setPrivatePage(1); }}\n        sortKey={privateSortKey}\n        sortOrder={privateSortOrder}\n        onSortKeyChange={(k) => { setPrivateSortKey(k); setPrivatePage(1); }}\n        onSortOrderToggle={() => { setPrivateSortOrder(o => o === 'asc' ? 'desc' : 'asc'); setPrivatePage(1); }}\n      />\n      <Section\n        title=\"Secure Rooms\"\n        items={groupedSorted.secure}\n        page={securePage}\n        perPage={securePerPage}\n        total={secureTotal}\n        onPageChange={(v) => setSecurePage(v)}\n        onPerPageChange={(v) => { setSecurePerPage(v); setSecurePage(1); }}\n        sortKey={secureSortKey}\n        sortOrder={secureSortOrder}\n        onSortKeyChange={(k) => { setSecureSortKey(k); setSecurePage(1); }}\n        onSortOrderToggle={() => { setSecureSortOrder(o => o === 'asc' ? 'desc' : 'asc'); setSecurePage(1); }}\n      />\n      <Section\n        title=\"Archived Rooms\"\n        items={groupedSorted.archived}\n        page={archivedPage}\n        perPage={archivedPerPage}\n        total={archivedTotal}\n        onPageChange={(v) => setArchivedPage(v)}\n        onPerPageChange={(v) => { setArchivedPerPage(v); setArchivedPage(1); }}\n        sortKey={archivedSortKey}\n        sortOrder={archivedSortOrder}\n        onSortKeyChange={(k) => { setArchivedSortKey(k); setArchivedPage(1); }}\n        onSortOrderToggle={() => { setArchivedSortOrder(o => o === 'asc' ? 'desc' : 'asc'); setArchivedPage(1); }}\n      />\n\n      {/* Create dialog */}\n      <Dialog open={openCreate} onClose={() => setOpenCreate(false)}>\n        <DialogTitle>Create {newType} room</DialogTitle>\n        <DialogContent>\n          <TextField label=\"Name\" value={newName} onChange={e => setNewName(e.target.value)} fullWidth />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setOpenCreate(false)}>Close</Button>\n          <Button onClick={doCreate} variant=\"contained\">Create</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Share dialog */}\n      <Dialog open={!!shareOpen} onClose={(e, reason) => {\n        // Keep dialog open if there are server-side share errors (user typed nonexistent usernames)\n        if (shareErrors && shareErrors.length) {\n          // ignore backdropClick or escapeKeyDown closing when errors exist\n          return;\n        }\n        setShareOpen(null); setShareUsers([]); setShareErrors([]);\n      }}>\n        <DialogTitle>Share room</DialogTitle>\n        <DialogContent>\n          <Typography variant=\"body2\" sx={{ mb: 1 }}>Add users to invite / share with. Select suggestions or type full usernames.</Typography>\n          <Autocomplete\n            multiple\n            freeSolo\n            open={suggestOpen}\n            onOpen={() => setSuggestOpen(true)}\n            onClose={() => setSuggestOpen(false)}\n            inputValue={shareInputValue}\n            onInputChange={(e, newInput) => setShareInputValue(newInput)}\n            options={suggestOptions}\n            // value is array of objects; render by username\n            value={shareUsers}\n            getOptionLabel={(opt) => typeof opt === 'string' ? opt : (opt.username || '')}\n            isOptionEqualToValue={(opt, val) => (opt.username || opt) === (val.username || val)}\n            loading={suggestLoading}\n            onChange={(e, newValue) => {\n              // Track which selections came from suggestion objects (objects vs free-typed strings)\n              try {\n                const selectedFromSuggest = (newValue || []).filter(v => typeof v !== 'string').map(v => (v && (v.username || v)) || '');\n                setShareSelectedSuggestions(selectedFromSuggest.filter(Boolean));\n              } catch (_) { setShareSelectedSuggestions([]); }\n\n              // newValue may contain strings or username objects; normalize to {username, role}\n              const norm = (newValue || []).map(v => {\n                if (typeof v === 'string') return { username: v, role: 'editor' };\n                return { username: v.username || '', role: v.role || 'editor' };\n              }).filter(x => x.username);\n              setShareUsers(norm);\n              setShareInputValue('');\n              try {\n                const remaining = (shareErrors || []).filter(err => norm.some(n => n.username === err.username));\n                setShareErrors(remaining);\n              } catch (ex) { }\n            }}\n            filterSelectedOptions\n            renderTags={(value, getTagProps) => {\n              const errMap = (shareErrors || []).reduce((acc, e) => { acc[e.username] = e; return acc; }, {});\n              return value.map((option, index) => {\n                const rawTagProps = getTagProps({ index }) || {};\n                const { key: _k, ...tagProps } = rawTagProps;\n                const err = errMap[option.username];\n                return (\n                  <Box key={option.username + index} sx={{ display: 'inline-flex', alignItems: 'center', gap: 0.5 }}>\n                    {err ? (\n                      <Tooltip title={`${err.error || 'user not found.'}`} placement=\"top\">\n                        <Chip {...tagProps} label={option.username} color=\"error\" />\n                      </Tooltip>\n                    ) : (\n                      <Chip {...tagProps} label={option.username} />\n                    )}\n                    <TextField\n                      size=\"small\"\n                      select\n                      value={option.role || 'editor'}\n                      onChange={(e) => {\n                        const role = e.target.value;\n                        setShareUsers(prev => prev.map(p => p.username === option.username ? { ...p, role } : p));\n                      }}\n                      sx={{ minWidth: 110 }}\n                    >\n                      <MenuItem value=\"editor\">Editor</MenuItem>\n                      <MenuItem value=\"viewer\">Viewer</MenuItem>\n                    </TextField>\n                  </Box>\n                );\n              });\n            }}\n            renderInput={(params) => {\n              const { ownerState, sx, className, ...safeParams } = params || {};\n              return (\n                <TextField\n                  {...safeParams}\n                  label=\"Usernames\"\n                  fullWidth\n                  onChange={(ev) => {\n                    const v = ev.target.value;\n                    setShareInputValue(v);\n                    debouncedUserSearch(v);\n                  }}\n                  InputProps={{\n                    ...safeParams.InputProps,\n                    endAdornment: (\n                      <>\n                        {suggestLoading ? <CircularProgress color=\"inherit\" size={20} /> : null}\n                        {safeParams.InputProps?.endAdornment}\n                      </>\n                    )\n                  }}\n                />\n              );\n            }}\n          />\n          {shareErrors.length > 0 && (\n            <Box sx={{ mt: 1 }}>\n              <Typography variant=\"body2\" color=\"error\">Some usernames were not found:</Typography>\n              {shareErrors.map((err, idx) => (\n                <Paper key={idx} sx={{ p: 1, mt: 0.5 }}>\n                  <Typography variant=\"body2\"><strong>{err.username}</strong>: {err.error}</Typography>\n                  {err.suggestions && err.suggestions.length > 0 && (\n                    <Typography variant=\"caption\">Suggestions: {err.suggestions.join(', ')}</Typography>\n                  )}\n                </Paper>\n              ))}\n            </Box>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => { setShareOpen(null); setShareUsers([]); setShareErrors([]); setShareInputValue(''); setShareSelectedSuggestions([]); }}>Close</Button>\n          {/* Only enable Share when at least one suggestion was selected or a non-empty typed username exists */}\n          <Button onClick={doShare} variant=\"contained\" disabled={!canShare}>Share</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Share link dialog */}\n      <Dialog open={!!shareLinkOpen} onClose={() => setShareLinkOpen(null)}>\n        <DialogTitle>Share link</DialogTitle>\n        <DialogContent>\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n            <TextField fullWidth value={`${window.location.origin}/rooms/${shareLinkOpen || ''}`} InputProps={{ readOnly: true }} />\n            <Button onClick={() => {\n              const link = `${window.location.origin}/rooms/${shareLinkOpen}`;\n              navigator.clipboard?.writeText(link).then(() => {\n              }).catch((err) => console.error('Copy failed', err));\n            }}>Copy</Button>\n          </Box>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setShareLinkOpen(null)}>Close</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Confirm Leave Dialog */}\n      <Dialog open={!!confirmLeaveOpen} onClose={() => setConfirmLeaveOpen(null)}>\n        <DialogTitle>Leave room</DialogTitle>\n        <DialogContent>\n          <Typography>Are you sure you want to leave this room?</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setConfirmLeaveOpen(null)}>Cancel</Button>\n          <Button variant=\"contained\" color=\"error\" onClick={async () => {\n            try {\n              const roomId = confirmLeaveOpen;\n              // Use the server leave API for all room types. Prefer the server\n              // to tell us whether membership was actually removed by returning\n              // a { removed: true|false } flag.\n              try {\n                const mod = await import('../api/rooms');\n                const resp = await mod.leaveRoom(auth.token, roomId);\n                // If server explicitly indicates removal, show appropriate message.\n                if (resp && typeof resp.removed === 'boolean') {\n                  if (resp.removed) setSnack({ open: true, message: 'Left room' });\n                  else setSnack({ open: true, message: 'Room removed from your lists' });\n                } else {\n                  // Backwards compatibility: assume success means left.\n                  setSnack({ open: true, message: 'Left room' });\n                }\n              } catch (e) {\n                console.error('Leave room failed', e);\n                if (e?.message && e.message.toLowerCase().includes('owner')) {\n                  setSnack({ open: true, message: 'You must transfer ownership before leaving this room.' });\n                } else {\n                  setSnack({ open: true, message: 'Failed to leave room: ' + (e?.message || e) });\n                }\n              }\n            } catch (e) {\n              console.error('Leave room failed', e);\n              if (e?.message && e.message.toLowerCase().includes('owner')) {\n                setSnack({ open: true, message: 'You must transfer ownership before leaving this room.' });\n              } else {\n                setSnack({ open: true, message: 'Failed to leave room: ' + (e?.message || e) });\n              }\n            } finally {\n              setConfirmLeaveOpen(null);\n              await refresh();\n            }\n          }}>Leave</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Confirm Archive Dialog (owner-only) */}\n      <Dialog open={!!confirmArchiveOpen} onClose={() => setConfirmArchiveOpen(null)}>\n        <DialogTitle>Archive room</DialogTitle>\n        <DialogContent>\n          <Typography>Are you sure you want to archive this room? Archiving hides the room from normal lists but preserves data. You can unarchive later.</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setConfirmArchiveOpen(null)}>Cancel</Button>\n          <Button variant=\"contained\" color=\"error\" onClick={async () => {\n            try {\n              const roomId = confirmArchiveOpen;\n              await updateRoom(auth.token, roomId, { archived: true });\n              setSnack({ open: true, message: 'Room archived' });\n            } catch (e) {\n              console.error('Archive room failed', e);\n              setSnack({ open: true, message: 'Failed to archive room: ' + (e?.message || e) });\n            } finally {\n              setConfirmArchiveOpen(null);\n              await refresh();\n            }\n          }}>Archive</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Confirm Unarchive Dialog (owner-only) */}\n      <Dialog open={!!confirmUnarchiveOpen} onClose={() => setConfirmUnarchiveOpen(null)}>\n        <DialogTitle>Unarchive room</DialogTitle>\n        <DialogContent>\n          <Typography>Are you sure you want to unarchive this room? This will return the room to active lists.</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setConfirmUnarchiveOpen(null)}>Cancel</Button>\n          <Button variant=\"contained\" color=\"primary\" onClick={async () => {\n            try {\n              const roomId = confirmUnarchiveOpen;\n              await updateRoom(auth.token, roomId, { archived: false });\n              setSnack({ open: true, message: 'Room unarchived' });\n            } catch (e) {\n              console.error('Unarchive room failed', e);\n              setSnack({ open: true, message: 'Failed to unarchive room: ' + (e?.message || e) });\n            } finally {\n              setConfirmUnarchiveOpen(null);\n              await refresh();\n            }\n          }}>Unarchive</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* 'Hide archived room' feature removed */}\n\n      {/* Confirm Destructive Delete (owner-only, irreversible) */}\n      <Dialog open={!!confirmDestructiveOpen} onClose={() => { setConfirmDestructiveOpen(null); setDestructiveConfirmText(''); }}>\n        <DialogTitle>Permanently delete room</DialogTitle>\n        <DialogContent>\n          <Typography color=\"error\" sx={{ mb: 1 }}>This action is irreversible. Deleting a room will permanently remove it and ALL its data for every user.</Typography>\n          <Typography sx={{ mb: 1 }}>To confirm, type <strong>DELETE</strong> in the box below.</Typography>\n          <TextField fullWidth value={destructiveConfirmText} onChange={e => setDestructiveConfirmText(e.target.value)} placeholder=\"Type DELETE to confirm\" />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => { setConfirmDestructiveOpen(null); setDestructiveConfirmText(''); }}>Cancel</Button>\n          <Button variant=\"contained\" color=\"error\" disabled={destructiveConfirmText !== 'DELETE'} onClick={async () => {\n            try {\n              const id = confirmDestructiveOpen;\n              const mod = await import('../api/rooms');\n              await mod.deleteRoom(auth.token, id);\n              setSnack({ open: true, message: 'Room permanently deleted' });\n            } catch (e) {\n              console.error('Permanent delete failed', e);\n              setSnack({ open: true, message: 'Failed to delete room: ' + (e?.message || e) });\n            } finally {\n              setConfirmDestructiveOpen(null);\n              setDestructiveConfirmText('');\n              await refresh();\n            }\n          }}>Delete permanently</Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* Snackbar for notifications */}\n      <Box>\n        <SafeSnackbar open={snack.open} message={snack.message} autoHideDuration={4000} onClose={() => setSnack({ open: false, message: '' })} />\n        <SafeSnackbar open={shareSuccess.open} message={shareSuccess.message} autoHideDuration={3500} onClose={() => setShareSuccess({ open: false, message: '' })} />\n      </Box>\n    </Box>\n  );\n}\n"],"names":["_ref","template","onSelect","_jsxs","Card","sx","cursor","transition","transform","boxShadow","children","_jsx","CardMedia","component","height","image","thumbnail","alt","name","CardContent","Typography","variant","gutterBottom","color","description","Box","display","gap","mt","flexWrap","tags","map","tag","Chip","label","size","difficulty","CardActions","Button","fullWidth","onClick","e","stopPropagation","onSelectTemplate","onClose","category","setCategory","useState","searchQuery","setSearchQuery","filteredTemplates","TEMPLATE_LIBRARY","filter","matchesCategory","q","toLowerCase","matchesSearch","includes","some","t","Dialog","open","fullScreen","AppBar","position","Toolbar","flexGrow","IconButton","CloseIcon","p","mb","TextField","placeholder","value","onChange","target","InputProps","startAdornment","SearchIcon","FormControl","minWidth","InputLabel","Select","MenuItem","Grid","container","spacing","item","xs","sm","md","lg","TemplateCard","id","length","textAlign","py","loadTemplate","templateId","canvas","find","Error","clear","setSize","width","setBackground","background","Array","isArray","objects","obj","addObject","zoomToFit","createFromTemplate","token","Date","toLocaleDateString","tkn","getAuthToken","createRoom","type","template_id","Dashboard","auth","nav","useNavigate","creatingTemplateRef","useRef","rooms","setRooms","archivedRooms","setArchivedRooms","invites","setInvites","openCreate","setOpenCreate","showTemplates","setShowTemplates","newName","setNewName","newType","setNewType","shareOpen","setShareOpen","shareUsers","setShareUsers","shareSelectedSuggestions","setShareSelectedSuggestions","shareInputValue","setShareInputValue","suggestOpen","setSuggestOpen","suggestOptions","setSuggestOptions","suggestLoading","setSuggestLoading","roomSearchValue","setRoomSearchValue","roomSuggestOpen","setRoomSuggestOpen","roomSuggestOptions","setRoomSuggestOptions","roomSuggestLoading","setRoomSuggestLoading","membersCache","setMembersCache","shareErrors","setShareErrors","shareSuccess","setShareSuccess","message","shareLinkOpen","setShareLinkOpen","confirmLeaveOpen","setConfirmLeaveOpen","confirmArchiveOpen","setConfirmArchiveOpen","confirmUnarchiveOpen","setConfirmUnarchiveOpen","confirmDestructiveOpen","setConfirmDestructiveOpen","destructiveConfirmText","setDestructiveConfirmText","snack","setSnack","publicSortKey","setPublicSortKey","localStorage","getItem","publicSortOrder","setPublicSortOrder","privateSortKey","setPrivateSortKey","privateSortOrder","setPrivateSortOrder","secureSortKey","setSecureSortKey","secureSortOrder","setSecureSortOrder","archivedSortKey","setArchivedSortKey","archivedSortOrder","setArchivedSortOrder","publicPage","setPublicPage","privatePage","setPrivatePage","securePage","setSecurePage","publicPerPage","setPublicPerPage","Number","privatePerPage","setPrivatePerPage","securePerPage","setSecurePerPage","publicTotal","setPublicTotal","privateTotal","setPrivateTotal","secureTotal","setSecureTotal","archivedPage","setArchivedPage","archivedPerPage","setArchivedPerPage","archivedTotal","setArchivedTotal","userSearchTimeoutRef","debouncedUserSearch","useCallback","current","clearTimeout","setTimeout","async","opts","suggestUsers","err","console","warn","roomSearchTimeoutRef","debouncedRoomSearch","suggestRooms","refresh","pubP","listRooms","includeArchived","sortBy","order","page","per_page","priP","secP","archivedP","pubRes","priRes","secRes","archivedRes","Promise","all","pubRooms","priRooms","secRooms","archivedAll","visibleArchived","combined","dedupMap","Map","r","has","set","dedupedRooms","from","values","total","listInvites","error","handleAuthError","useEffect","onRoomsUpdated","window","addEventListener","removeEventListener","setSocketToken","sock","getSocket","onRoomAccessGranted","payload","log","roomName","onUserRemovedFromRoom","onRoomDeleted","onInviteReceived","then","inv","catch","onInviteAccepted","prev","inviteId","onInviteDeclined","on","off","setItem","String","canShare","u","uname","username","opt","Section","_ref2","title","items","perPage","onPageChange","onPerPageChange","sortKey","sortOrder","onSortKeyChange","onSortOrderToggle","safePerPage","safePage","safeTotal","handlePerPage","handlePage","startIndex","endIndex","Math","min","pageRangeLabel","Stack","direction","alignItems","opacity","flex","ml","select","EditIcon","fontSize","CalendarTodayIcon","SortByAlphaIcon","GroupIcon","ArrowUpwardIcon","ArrowDownwardIcon","Pagination","count","max","ceil","v","isOwner","myRole","getUsername","ownerName","Paper","justifyContent","RouterLinkWrapper","to","style","textDecoration","Tooltip","members","m","i","loading","onOpen","ms","getRoomMembers","memberCount","wordBreak","updatedAt","toLocaleString","createdAt","flexShrink","archived","_Fragment","groupedSorted","public","private","secure","minHeight","TemplateGallery","created","TemplateLoader","response","status","_e$body","errorMsg","body","maxWidth","Autocomplete","freeSolo","options","getOptionLabel","onInputChange","newInput","newValue","trim","match","renderInput","params","_safeParams$InputProp","ownerState","className","safeParams","endAdornment","CircularProgress","renderOption","props","option","rest","_createElement","key","flexDirection","inviterName","role","acceptInvite","declineInvite","Divider","k","o","DialogTitle","DialogContent","DialogActions","nameError","clientValidation","typeError","roomType","errorMessage","formatErrorMessage","reason","multiple","inputValue","isOptionEqualToValue","val","selectedFromSuggest","Boolean","_","norm","x","remaining","n","ex","filterSelectedOptions","renderTags","getTagProps","errMap","reduce","acc","index","rawTagProps","_k","tagProps","placement","_safeParams$InputProp2","ev","idx","suggestions","join","users","slice","resp","shareRoom","res","results","errors","invited","updated","succeeded","disabled","location","origin","readOnly","_navigator$clipboard","link","navigator","clipboard","writeText","roomId","mod","leaveRoom","removed","updateRoom","deleteRoom","SafeSnackbar","autoHideDuration"],"sourceRoot":""}