"use strict";(self.webpackChunkcanvas_app=self.webpackChunkcanvas_app||[]).push([[110],{11110:(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});var n=r(65043),o=r(7353),s=r(80683),a=r(94496),i=r(15795),l=r(32143),c=r(17392),d=r(59135),m=r(61596),u=r(43845),h=r(77739),g=r(11906),p=r(81637),x=r(39336),v=r(90035),A=r(26600),j=r(35316),f=r(29347),y=r(59540),S=r(88645),w=r(87241),b=r(47225),C=r(83560),k=r(58997),I=r(64165),P=r(82357),z=r(92314),T=r(55263),R=r(53193),O=r(79190),N=r(72221),L=r(68903),_=r(33438),E=r(79484),$=r(12110),D=r(36591),F=r(26494),K=r(27600),W=r(70579);const B=function(e){let{template:t,onSelect:r}=e;return(0,W.jsxs)($.A,{sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:3}},children:[(0,W.jsx)(D.A,{component:"img",height:"160",image:t.thumbnail,alt:t.name}),(0,W.jsxs)(F.A,{children:[(0,W.jsx)(a.A,{variant:"h6",gutterBottom:!0,children:t.name}),(0,W.jsx)(a.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:t.description}),(0,W.jsx)(o.A,{display:"flex",gap:.5,mt:1,flexWrap:"wrap",children:(t.tags||[]).map((e=>(0,W.jsx)(u.A,{label:e,size:"small"},e)))}),(0,W.jsx)(o.A,{mt:1,children:(0,W.jsx)(u.A,{label:t.difficulty,size:"small",color:"beginner"===t.difficulty?"success":"intermediate"===t.difficulty?"warning":"error"})})]}),(0,W.jsx)(K.A,{children:(0,W.jsx)(g.A,{size:"small",fullWidth:!0,variant:"contained",onClick:e=>{e.stopPropagation(),r()},children:"Use Template"})})]})};var U=r(94302);const Y=function(e){let{onSelectTemplate:t,onClose:r}=e;const[s,d]=(0,n.useState)("all"),[m,u]=(0,n.useState)(""),h=U.j.filter((e=>{const t="all"===s||e.category===s,r=(m||"").toLowerCase(),n=!r||e.name.toLowerCase().includes(r)||(e.tags||[]).some((e=>e.includes(r)));return t&&n}));return(0,W.jsxs)(v.A,{open:!0,fullScreen:!0,onClose:r,children:[(0,W.jsx)(z.A,{position:"static",children:(0,W.jsxs)(T.A,{children:[(0,W.jsx)(a.A,{variant:"h6",sx:{flexGrow:1},children:"Choose a Template"}),(0,W.jsx)(c.A,{color:"inherit",onClick:r,children:(0,W.jsx)(_.A,{})})]})}),(0,W.jsxs)(o.A,{p:3,children:[(0,W.jsxs)(o.A,{display:"flex",gap:2,mb:3,children:[(0,W.jsx)(i.A,{fullWidth:!0,placeholder:"Search templates...",value:m,onChange:e=>u(e.target.value),InputProps:{startAdornment:(0,W.jsx)(E.A,{})}}),(0,W.jsxs)(R.A,{sx:{minWidth:200},children:[(0,W.jsx)(O.A,{children:"Category"}),(0,W.jsxs)(N.A,{value:s,onChange:e=>d(e.target.value),children:[(0,W.jsx)(l.A,{value:"all",children:"All Categories"}),(0,W.jsx)(l.A,{value:"business",children:"Business"}),(0,W.jsx)(l.A,{value:"design",children:"Design"}),(0,W.jsx)(l.A,{value:"education",children:"Education"}),(0,W.jsx)(l.A,{value:"engineering",children:"Engineering"}),(0,W.jsx)(l.A,{value:"games",children:"Games"})]})]})]}),(0,W.jsx)(L.Ay,{container:!0,spacing:3,children:h.map((e=>(0,W.jsx)(L.Ay,{item:!0,xs:12,sm:6,md:4,lg:3,children:(0,W.jsx)(B,{template:e,onSelect:()=>t(e)})},e.id)))}),0===h.length&&(0,W.jsx)(o.A,{textAlign:"center",py:8,children:(0,W.jsx)(a.A,{variant:"h6",color:"textSecondary",children:"No templates found"})})]})]})};var M=r(75267),V=r(89405);const H=class{static async loadTemplate(e,t){const r=U.j.find((t=>t.id===e));if(!r)throw new Error("Template not found");if(t&&"function"===typeof t.clear&&t.clear(),t&&"function"===typeof t.setSize&&r.canvas&&(t.setSize(r.canvas.width,r.canvas.height),"function"===typeof t.setBackground&&t.setBackground(r.canvas.background)),t&&r.canvas&&Array.isArray(r.canvas.objects))for(const o of r.canvas.objects)if("function"===typeof t.addObject)try{await t.addObject(o)}catch(n){}return t&&"function"===typeof t.zoomToFit&&t.zoomToFit(),r}static async createFromTemplate(e,t){const r=U.j.find((t=>t.id===e));if(!r)throw new Error("Template not found");const n=`${r.name} - ${(new Date).toLocaleDateString()}`,o=t||(0,V.c4)();return await(0,M.createRoom)(o,{name:n,type:"private",template_id:e})}};var G=r(90422),Z=r(52134),q=r(59479),J=r(8925),Q=r(17682);function X(e){let{auth:t}=e;const z=(0,Z.Zp)(),T=(0,n.useRef)(!1),[R,O]=(0,n.useState)([]),[N,L]=(0,n.useState)([]),[_,E]=(0,n.useState)([]),[$,D]=(0,n.useState)(!1),[F,K]=(0,n.useState)(!1),[B,U]=(0,n.useState)(""),[X,ee]=(0,n.useState)("public"),[te,re]=(0,n.useState)(null),[ne,oe]=(0,n.useState)([]),[se,ae]=(0,n.useState)([]),[ie,le]=(0,n.useState)(""),[ce,de]=(0,n.useState)(!1),[me,ue]=(0,n.useState)([]),[he,ge]=(0,n.useState)(!1),[pe,xe]=(0,n.useState)(""),[ve,Ae]=(0,n.useState)(!1),[je,fe]=(0,n.useState)([]),[ye,Se]=(0,n.useState)(!1),[we,be]=(0,n.useState)({}),[Ce,ke]=(0,n.useState)([]),[Ie,Pe]=(0,n.useState)({open:!1,message:""}),[ze,Te]=(0,n.useState)(null),[Re,Oe]=(0,n.useState)(null),[Ne,Le]=(0,n.useState)(null),[_e,Ee]=(0,n.useState)(null),[$e,De]=(0,n.useState)(null),[Fe,Ke]=(0,n.useState)(""),[We,Be]=(0,n.useState)({open:!1,message:""}),[Ue,Ye]=(0,n.useState)((()=>localStorage.getItem("rescanvas:publicSortKey")||"updatedAt")),[Me,Ve]=(0,n.useState)((()=>localStorage.getItem("rescanvas:publicSortOrder")||"desc")),[He,Ge]=(0,n.useState)((()=>localStorage.getItem("rescanvas:privateSortKey")||"updatedAt")),[Ze,qe]=(0,n.useState)((()=>localStorage.getItem("rescanvas:privateSortOrder")||"desc")),[Je,Qe]=(0,n.useState)((()=>localStorage.getItem("rescanvas:secureSortKey")||"updatedAt")),[Xe,et]=(0,n.useState)((()=>localStorage.getItem("rescanvas:secureSortOrder")||"desc")),[tt,rt]=(0,n.useState)((()=>localStorage.getItem("rescanvas:archivedSortKey")||"updatedAt")),[nt,ot]=(0,n.useState)((()=>localStorage.getItem("rescanvas:archivedSortOrder")||"desc")),[st,at]=(0,n.useState)(1),[it,lt]=(0,n.useState)(1),[ct,dt]=(0,n.useState)(1),[mt,ut]=(0,n.useState)((()=>Number(localStorage.getItem("rescanvas:publicPerPage"))||20)),[ht,gt]=(0,n.useState)((()=>Number(localStorage.getItem("rescanvas:privatePerPage"))||20)),[pt,xt]=(0,n.useState)((()=>Number(localStorage.getItem("rescanvas:securePerPage"))||20)),[vt,At]=(0,n.useState)(0),[jt,ft]=(0,n.useState)(0),[yt,St]=(0,n.useState)(0),[wt,bt]=(0,n.useState)(1),[Ct,kt]=(0,n.useState)((()=>Number(localStorage.getItem("rescanvas:archivedPerPage"))||20)),[It,Pt]=(0,n.useState)(0),zt=(0,n.useRef)(null),Tt=(0,n.useCallback)((e=>{zt.current&&clearTimeout(zt.current),!e||e.length<2?ue([]):(ge(!0),zt.current=setTimeout((async()=>{try{const r=await(0,M.suggestUsers)(t.token,e);ue(r||[])}catch(r){console.warn("suggestUsers failed",r),ue([])}finally{ge(!1)}}),300))}),[t.token]),Rt=(0,n.useRef)(null),Ot=(0,n.useCallback)((e=>{Rt.current&&clearTimeout(Rt.current),!e||e.length<2?fe([]):(Se(!0),Rt.current=setTimeout((async()=>{try{const r=await(0,M.suggestRooms)(t.token,e);fe(r||[])}catch(r){console.warn("suggestRooms failed",r),fe([])}finally{Se(!1)}}),300))}),[t.token]);async function Nt(){if(null!==t&&void 0!==t&&t.token)try{const e=(0,M.listRooms)(t.token,{includeArchived:!1,sortBy:Ue,order:Me,page:st,per_page:mt,type:"public"}),r=(0,M.listRooms)(t.token,{includeArchived:!1,sortBy:He,order:Ze,page:it,per_page:ht,type:"private"}),n=(0,M.listRooms)(t.token,{includeArchived:!1,sortBy:Je,order:Xe,page:ct,per_page:pt,type:"secure"}),o=(0,M.listRooms)(t.token,{includeArchived:!0,sortBy:tt,order:nt,page:wt,per_page:Ct}),[s,a,i,l]=await Promise.all([e,r,n,o]),c=(null===s||void 0===s?void 0:s.rooms)||[],d=(null===a||void 0===a?void 0:a.rooms)||[],m=(null===i||void 0===i?void 0:i.rooms)||[],u=(null===l||void 0===l?void 0:l.rooms)||[],h=u,g=[...c,...d,...m],p=new Map;for(const t of g)t&&t.id&&(p.has(t.id)||p.set(t.id,t));const x=Array.from(p.values());O(x),At(s&&"number"===typeof s.total?s.total:c.length),ft(a&&"number"===typeof a.total?a.total:d.length),St(i&&"number"===typeof i.total?i.total:m.length),L(h),Pt(l&&"number"===typeof l.total?l.total:u.length),E(await(0,M.listInvites)(t.token))}catch(e){console.error("Dashboard refresh failed:",e),(0,V.tu)(e)}}(0,n.useEffect)((()=>()=>{zt.current&&clearTimeout(zt.current),Rt.current&&clearTimeout(Rt.current)}),[]),(0,n.useEffect)((()=>{Nt()}),[null===t||void 0===t?void 0:t.token]),(0,n.useEffect)((()=>{Nt()}),[Ue,Me,He,Ze,Je,Xe,tt,nt,st,it,ct,wt,mt,ht,pt,Ct]),(0,n.useEffect)((()=>{function e(){Nt()}return window.addEventListener("rescanvas:rooms-updated",e),()=>window.removeEventListener("rescanvas:rooms-updated",e)}),[]),(0,n.useEffect)((()=>{if(null!==t&&void 0!==t&&t.token)try{(0,Q.FP)(t.token);const e=(0,Q.Ol)(t.token),r=e=>{console.log("Room access granted:",e),Be({open:!0,message:`You were added to room: ${e.roomName||"a room"}`}),Nt()},n=e=>{console.log("User removed from room:",e),Be({open:!0,message:e.message||"You were removed from a room"}),Nt()},o=e=>{console.log("Room deleted:",e),Be({open:!0,message:"A room was deleted"}),Nt()},s=e=>{console.log("Invite received:",e),Be({open:!0,message:`You were invited to room: ${e.roomName||"a room"}`}),(0,M.listInvites)(t.token).then((e=>E(e))).catch((e=>console.error("Failed to refresh invites:",e)))},a=e=>{console.log("Invite accepted:",e),E((t=>t.filter((t=>t.id!==e.inviteId))))},i=e=>{console.log("Invite declined:",e),E((t=>t.filter((t=>t.id!==e.inviteId))))};return e.on("room_access_granted",r),e.on("user_removed_from_room",n),e.on("room_deleted",o),e.on("invite_received",s),e.on("invite_accepted",a),e.on("invite_declined",i),()=>{try{e.off("room_access_granted",r),e.off("user_removed_from_room",n),e.off("room_deleted",o),e.off("invite_received",s),e.off("invite_accepted",a),e.off("invite_declined",i)}catch(t){}}}catch(e){console.error("Failed to setup socket listeners:",e)}}),[null===t||void 0===t?void 0:t.token]),(0,n.useEffect)((()=>{try{localStorage.setItem("rescanvas:publicSortKey",Ue)}catch(e){}try{localStorage.setItem("rescanvas:publicSortOrder",Me)}catch(e){}try{localStorage.setItem("rescanvas:privateSortKey",He)}catch(e){}try{localStorage.setItem("rescanvas:privateSortOrder",Ze)}catch(e){}try{localStorage.setItem("rescanvas:secureSortKey",Je)}catch(e){}try{localStorage.setItem("rescanvas:secureSortOrder",Xe)}catch(e){}try{localStorage.setItem("rescanvas:archivedSortKey",tt)}catch(e){}try{localStorage.setItem("rescanvas:archivedSortOrder",nt)}catch(e){}try{localStorage.setItem("rescanvas:publicPerPage",String(mt))}catch(e){}try{localStorage.setItem("rescanvas:privatePerPage",String(ht))}catch(e){}try{localStorage.setItem("rescanvas:securePerPage",String(pt))}catch(e){}try{localStorage.setItem("rescanvas:archivedPerPage",String(Ct))}catch(e){}}),[Ue,Me,He,Ze,Je,Xe,tt,nt,mt,ht,pt,Ct]);const Lt=Array.isArray(ne)&&(ne||[]).some((e=>{const t=e&&(e.username||e)||"";return(me||[]).some((e=>(e&&(e.username||e))===t))}));function _t(e){let{title:r,items:n,page:p=1,perPage:x=20,total:v=0,onPageChange:A,onPerPageChange:j,sortKey:f,sortOrder:I,onSortKeyChange:P,onSortOrderToggle:z}=e;const T=[10,20,50,100].includes(x)?x:20,R="number"===typeof p&&p>0?p:1,O="number"===typeof v?v:0,N="function"===typeof j?j:()=>{},L="function"===typeof A?A:()=>{},_="number"===typeof O&&O>0?(R-1)*T+1:0,E="number"===typeof O&&O>0?Math.min(O,R*T):0,$=O>0?`${_}${_===E?"":"\u2013"+E} of ${O}`:`${O} total`;return(0,W.jsxs)(o.A,{children:[(0,W.jsxs)(s.A,{direction:"row",alignItems:"center",spacing:1,sx:{mb:.5},children:[(0,W.jsx)(a.A,{variant:"overline",sx:{opacity:.7},children:r}),(0,W.jsx)(o.A,{sx:{flex:1}}),"number"===typeof O&&(0,W.jsx)(a.A,{variant:"caption",color:"text.secondary",children:$}),(0,W.jsx)(a.A,{variant:"caption",sx:{opacity:.7,ml:1},children:"Sort:"}),(0,W.jsxs)(i.A,{size:"small",select:!0,value:f,onChange:e=>P&&P(e.target.value),sx:{minWidth:180,ml:.5},children:[(0,W.jsx)(l.A,{value:"updatedAt",children:(0,W.jsxs)(s.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(C.A,{fontSize:"small"})," ",(0,W.jsx)(a.A,{variant:"body2",children:"Last edited"})]})}),(0,W.jsx)(l.A,{value:"createdAt",children:(0,W.jsxs)(s.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(b.A,{fontSize:"small"})," ",(0,W.jsx)(a.A,{variant:"body2",children:"Created"})]})}),(0,W.jsx)(l.A,{value:"name",children:(0,W.jsxs)(s.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(k.A,{fontSize:"small"})," ",(0,W.jsx)(a.A,{variant:"body2",children:"Name (A \u2192 Z)"})]})}),(0,W.jsx)(l.A,{value:"memberCount",children:(0,W.jsxs)(s.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(w.A,{fontSize:"small"})," ",(0,W.jsx)(a.A,{variant:"body2",children:"Members"})]})})]}),(0,W.jsx)(c.A,{size:"small",onClick:()=>z&&z(),"aria-label":"toggle-sort-order",children:"asc"===I?(0,W.jsx)(y.A,{fontSize:"small"}):(0,W.jsx)(S.A,{fontSize:"small"})}),(0,W.jsxs)(i.A,{select:!0,size:"small",value:String(T),onChange:e=>N(Number(e.target.value)),sx:{width:110,ml:1},children:[(0,W.jsx)(l.A,{value:10,children:"10 / page"}),(0,W.jsx)(l.A,{value:20,children:"20 / page"}),(0,W.jsx)(l.A,{value:50,children:"50 / page"}),(0,W.jsx)(l.A,{value:100,children:"100 / page"})]}),(0,W.jsx)(d.A,{count:Math.max(1,Math.ceil((O||0)/T)),page:R,onChange:(e,t)=>L(t),size:"small",sx:{ml:1}})]}),(0,W.jsx)(s.A,{sx:{mt:.5},spacing:.5,children:n.map((e=>{const r=(()=>{if("owner"===e.myRole)return!0;try{const r=(0,G.T)(t);return!(!r||!e.ownerName||r!==e.ownerName)}catch(r){return!1}})();return(0,W.jsxs)(m.A,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:.5},children:[(0,W.jsxs)(o.A,{sx:{flex:1,minWidth:"200px"},children:[(0,W.jsx)(a.A,{variant:"subtitle2",component:q.A,to:`/rooms/${e.id}`,style:{textDecoration:"none"},children:e.name}),(0,W.jsxs)(s.A,{direction:"row",spacing:.5,sx:{mt:.25,flexWrap:"wrap"},children:[(0,W.jsx)(u.A,{size:"small",label:e.type,sx:{fontSize:"0.7rem"}}),(0,W.jsx)(h.A,{title:we[e.id]&&we[e.id].members&&we[e.id].members.length?(0,W.jsx)(o.A,{children:(we[e.id].members||[]).map(((e,t)=>(0,W.jsx)(a.A,{variant:"body2",children:e&&e.username?e.username:String(e)},t)))}):we[e.id]&&we[e.id].loading?"Loading...":"No members listed",onOpen:async()=>{if(e.id&&!we[e.id]){be((t=>({...t,[e.id]:{loading:!0,members:[]}})));try{const r=await(0,M.getRoomMembers)(t.token,e.id);be((t=>({...t,[e.id]:{loading:!1,members:r||[]}})))}catch(r){be((t=>({...t,[e.id]:{loading:!1,members:[]}})))}}},children:(0,W.jsx)(u.A,{size:"small",label:`${e.memberCount} member${1!==e.memberCount?"s":""}`,sx:{fontSize:"0.7rem"}})}),e.ownerName&&(0,W.jsx)(u.A,{size:"small",label:`owner: ${e.ownerName}`,sx:{fontSize:"0.7rem"}})]}),e.description&&(0,W.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mt:.5,wordBreak:"break-word"},children:e.description}),(0,W.jsxs)(s.A,{direction:"row",spacing:1,sx:{mt:.5,alignItems:"center",flexWrap:"wrap"},children:[e.updatedAt&&(0,W.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:["Last edited: ",new Date(e.updatedAt).toLocaleString()]}),e.createdAt&&(0,W.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:["Created: ",new Date(e.createdAt).toLocaleString()]})]})]}),(0,W.jsx)(s.A,{direction:"row",spacing:.5,sx:{flexShrink:0},children:e.archived?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(g.A,{size:"small",component:q.A,to:`/rooms/${e.id}`,children:"View"}),r?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(g.A,{size:"small",color:"primary",onClick:()=>Ee(e.id),children:"Unarchive"}),(0,W.jsx)(g.A,{size:"small",color:"error",onClick:()=>De(e.id),children:"Delete (permanent)"})]}):(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(g.A,{size:"small",color:"error",onClick:()=>Oe(e.id),children:"Leave"})})]}):(0,W.jsxs)(W.Fragment,{children:["public"===e.type?(0,W.jsx)(g.A,{size:"small",onClick:()=>Te(e.id),children:"Share link"}):(0,W.jsx)(g.A,{size:"small",onClick:()=>re(e.id),children:"Share"}),r?(0,W.jsx)(g.A,{size:"small",color:"error",onClick:()=>Le(e.id),children:"Archive"}):(0,W.jsx)(g.A,{size:"small",color:"error",onClick:()=>Oe(e.id),children:"Leave"})]})})]},e.id)}))})]})}const Et={public:R.filter((e=>"public"===e.type)),private:R.filter((e=>"private"===e.type)),secure:R.filter((e=>"secure"===e.type)),archived:N};return(0,W.jsxs)(o.A,{sx:{minHeight:0,p:1.5,display:"grid",gap:1.5},children:[(0,W.jsx)(a.A,{variant:"h5",children:"Dashboard"}),(0,W.jsxs)(s.A,{direction:"row",spacing:.75,flexWrap:"wrap",children:[(0,W.jsx)(g.A,{variant:"contained",size:"small",onClick:()=>{ee("public"),D(!0)},children:"New Public"}),(0,W.jsx)(g.A,{variant:"contained",size:"small",onClick:()=>{ee("private"),D(!0)},children:"New Private"}),(0,W.jsx)(g.A,{variant:"contained",size:"small",onClick:()=>{ee("secure"),D(!0)},children:"New Secure"}),(0,W.jsx)(g.A,{variant:"outlined",size:"small",onClick:()=>K(!0),children:"Templates"})]}),F&&(0,W.jsx)(Y,{onClose:()=>K(!1),onSelectTemplate:async e=>{if(T.current)console.log("[Template] Already creating template, ignoring duplicate call");else{T.current=!0;try{console.log("[Template] Creating room from template:",e.id);const r=await H.createFromTemplate(e.id,null===t||void 0===t?void 0:t.token);r&&r.id&&(K(!1),z(`/rooms/${r.id}`))}catch(n){if(console.error("Create from template failed",n),n.response&&429===n.response.status){var r;const e=(null===(r=n.body)||void 0===r?void 0:r.message)||"You've reached the limit for room creation. Please try again later.";console.warn("[Template] Rate limit exceeded:",e),Be({open:!0,message:e}),K(!1)}else K(!1)}finally{setTimeout((()=>{T.current=!1}),1e3)}}}}),(0,W.jsx)(o.A,{sx:{mt:1,maxWidth:560},children:(0,W.jsx)(P.A,{freeSolo:!0,open:ve,onOpen:()=>Ae(!0),onClose:()=>Ae(!1),options:je,getOptionLabel:e=>"string"===typeof e?e:e.name||"",onInputChange:(e,t)=>{xe(t),Ot(t)},loading:ye,onChange:(e,t)=>{if(t&&"object"===typeof t&&t.id)z(`/rooms/${t.id}`);else if("string"===typeof t&&t.trim()){const e=(je||[]).find((e=>e.name===t||e.id===t));e&&e.id&&z(`/rooms/${e.id}`)}xe(""),fe([]),Ae(!1)},renderInput:e=>{var t;const{ownerState:r,sx:n,className:o,...s}=e||{};return(0,W.jsx)(i.A,{...s,label:"Search public rooms",placeholder:"Type to find public rooms",InputProps:{...s.InputProps,endAdornment:(0,W.jsxs)(W.Fragment,{children:[ye?(0,W.jsx)(p.A,{color:"inherit",size:20}):null,null===(t=s.InputProps)||void 0===t?void 0:t.endAdornment]})}})},renderOption:(e,t)=>{const{ownerState:r,sx:s,className:i,...l}=e||{};return(0,n.createElement)("li",{...l,key:t.id},(0,W.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(a.A,{variant:"body2",children:t.name}),(0,W.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:[t.ownerName||""," \xb7 ",t.memberCount||0," members"]})]}))}})}),(0,W.jsxs)(o.A,{children:[(0,W.jsx)(a.A,{variant:"overline",sx:{opacity:.7},children:"Pending Invites"}),(0,W.jsxs)(s.A,{sx:{mt:.5},spacing:.5,children:[0===_.length&&(0,W.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"None"}),_.map((e=>(0,W.jsxs)(m.A,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:.5},children:[(0,W.jsxs)(o.A,{sx:{flex:1,minWidth:"200px"},children:[(0,W.jsx)(a.A,{variant:"subtitle2",sx:{wordBreak:"break-word"},children:e.roomName}),(0,W.jsxs)(a.A,{variant:"body2",color:"text.secondary",sx:{wordBreak:"break-word"},children:["Invited by ",e.inviterName," as ",e.role]})]}),(0,W.jsxs)(s.A,{direction:"row",spacing:.5,sx:{flexShrink:0},children:[(0,W.jsx)(g.A,{variant:"contained",size:"small",onClick:async()=>{try{await(0,M.acceptInvite)(t.token,e.id)}catch(r){null!==r&&void 0!==r&&r.message&&r.message.includes("Invite not pending")?console.warn("Invite race: not pending, refreshing invites"):console.error("Accept invite failed",r)}finally{await Nt()}},children:"Accept"}),(0,W.jsx)(g.A,{size:"small",onClick:async()=>{try{await(0,M.declineInvite)(t.token,e.id)}catch(r){console.warn("Decline invite error (ignored):",(null===r||void 0===r?void 0:r.message)||r)}finally{await Nt()}},children:"Decline"})]})]},e.id)))]})]}),(0,W.jsx)(x.A,{}),(0,W.jsx)(_t,{title:"Public Rooms",items:Et.public,page:st,perPage:mt,total:vt,onPageChange:e=>at(e),onPerPageChange:e=>{ut(e),at(1)},sortKey:Ue,sortOrder:Me,onSortKeyChange:e=>{Ye(e),at(1)},onSortOrderToggle:()=>{Ve((e=>"asc"===e?"desc":"asc")),at(1)}}),(0,W.jsx)(_t,{title:"Private Rooms",items:Et.private,page:it,perPage:ht,total:jt,onPageChange:e=>lt(e),onPerPageChange:e=>{gt(e),lt(1)},sortKey:He,sortOrder:Ze,onSortKeyChange:e=>{Ge(e),lt(1)},onSortOrderToggle:()=>{qe((e=>"asc"===e?"desc":"asc")),lt(1)}}),(0,W.jsx)(_t,{title:"Secure Rooms",items:Et.secure,page:ct,perPage:pt,total:yt,onPageChange:e=>dt(e),onPerPageChange:e=>{xt(e),dt(1)},sortKey:Je,sortOrder:Xe,onSortKeyChange:e=>{Qe(e),dt(1)},onSortOrderToggle:()=>{et((e=>"asc"===e?"desc":"asc")),dt(1)}}),(0,W.jsx)(_t,{title:"Archived Rooms",items:Et.archived,page:wt,perPage:Ct,total:It,onPageChange:e=>bt(e),onPerPageChange:e=>{kt(e),bt(1)},sortKey:tt,sortOrder:nt,onSortKeyChange:e=>{rt(e),bt(1)},onSortOrderToggle:()=>{ot((e=>"asc"===e?"desc":"asc")),bt(1)}}),(0,W.jsxs)(v.A,{open:$,onClose:()=>D(!1),children:[(0,W.jsxs)(A.A,{children:["Create ",X," room"]}),(0,W.jsx)(j.A,{children:(0,W.jsx)(i.A,{label:"Name",value:B,onChange:e=>U(e.target.value),fullWidth:!0})}),(0,W.jsxs)(f.A,{children:[(0,W.jsx)(g.A,{onClick:()=>D(!1),children:"Close"}),(0,W.jsx)(g.A,{onClick:async function(){const e=J.Pv.roomName(B);if(e)return void Be({open:!0,message:e});const r=J.Pv.roomType(X);if(r)Be({open:!0,message:r});else try{const e=await(0,M.createRoom)(t.token,{name:B,type:X});D(!1),U(""),await Nt(),z(`/rooms/${e.id}`)}catch(n){const e=(0,J.NR)(n);Be({open:!0,message:e})}},variant:"contained",children:"Create"})]})]}),(0,W.jsxs)(v.A,{open:!!te,onClose:(e,t)=>{Ce&&Ce.length||(re(null),oe([]),ke([]))},children:[(0,W.jsx)(A.A,{children:"Share room"}),(0,W.jsxs)(j.A,{children:[(0,W.jsx)(a.A,{variant:"body2",sx:{mb:1},children:"Add users to invite / share with. Select suggestions or type full usernames."}),(0,W.jsx)(P.A,{multiple:!0,freeSolo:!0,open:ce,onOpen:()=>de(!0),onClose:()=>de(!1),inputValue:ie,onInputChange:(e,t)=>le(t),options:me,value:ne,getOptionLabel:e=>"string"===typeof e?e:e.username||"",isOptionEqualToValue:(e,t)=>(e.username||e)===(t.username||t),loading:he,onChange:(e,t)=>{try{const e=(t||[]).filter((e=>"string"!==typeof e)).map((e=>e&&(e.username||e)||""));ae(e.filter(Boolean))}catch(n){ae([])}const r=(t||[]).map((e=>"string"===typeof e?{username:e,role:"editor"}:{username:e.username||"",role:e.role||"editor"})).filter((e=>e.username));oe(r),le("");try{const e=(Ce||[]).filter((e=>r.some((t=>t.username===e.username))));ke(e)}catch(o){}},filterSelectedOptions:!0,renderTags:(e,t)=>{const r=(Ce||[]).reduce(((e,t)=>(e[t.username]=t,e)),{});return e.map(((e,n)=>{const s=t({index:n})||{},{key:a,...c}=s,d=r[e.username];return(0,W.jsxs)(o.A,{sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[d?(0,W.jsx)(h.A,{title:`${d.error||"user not found."}`,placement:"top",children:(0,W.jsx)(u.A,{...c,label:e.username,color:"error"})}):(0,W.jsx)(u.A,{...c,label:e.username}),(0,W.jsxs)(i.A,{size:"small",select:!0,value:e.role||"editor",onChange:t=>{const r=t.target.value;oe((t=>t.map((t=>t.username===e.username?{...t,role:r}:t))))},sx:{minWidth:110},children:[(0,W.jsx)(l.A,{value:"editor",children:"Editor"}),(0,W.jsx)(l.A,{value:"viewer",children:"Viewer"})]})]},e.username+n)}))},renderInput:e=>{var t;const{ownerState:r,sx:n,className:o,...s}=e||{};return(0,W.jsx)(i.A,{...s,label:"Usernames",fullWidth:!0,onChange:e=>{const t=e.target.value;le(t),Tt(t)},InputProps:{...s.InputProps,endAdornment:(0,W.jsxs)(W.Fragment,{children:[he?(0,W.jsx)(p.A,{color:"inherit",size:20}):null,null===(t=s.InputProps)||void 0===t?void 0:t.endAdornment]})}})}}),Ce.length>0&&(0,W.jsxs)(o.A,{sx:{mt:1},children:[(0,W.jsx)(a.A,{variant:"body2",color:"error",children:"Some usernames were not found:"}),Ce.map(((e,t)=>(0,W.jsxs)(m.A,{sx:{p:1,mt:.5},children:[(0,W.jsxs)(a.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:e.username}),": ",e.error]}),e.suggestions&&e.suggestions.length>0&&(0,W.jsxs)(a.A,{variant:"caption",children:["Suggestions: ",e.suggestions.join(", ")]})]},t)))]})]}),(0,W.jsxs)(f.A,{children:[(0,W.jsx)(g.A,{onClick:()=>{re(null),oe([]),ke([]),le(""),ae([])},children:"Close"}),(0,W.jsx)(g.A,{onClick:async function(){let e=Array.isArray(ne)?ne.slice():[];ie&&"string"===typeof ie&&ie.trim()&&(e=[...e,{username:ie.trim(),role:"editor"}]);try{const r=await(0,M.shareRoom)(t.token,te,e),n=r&&r.results||{},o=n.errors||[],s=(n.invited||[]).map((e=>e.username)),a=(n.updated||[]).map((e=>e.username)),i=[...s,...a];if(o&&o.length)return ke(o),void(i.length&&Pe({open:!0,message:`Shared with ${i.join(", ")}`}));i.length&&Pe({open:!0,message:`Shared with ${i.join(", ")}`}),re(null),oe([]),ke([]),le(""),await Nt()}catch(r){console.error("Share failed",r);const e=(0,J.NR)(r);Be({open:!0,message:e})}},variant:"contained",disabled:!Lt,children:"Share"})]})]}),(0,W.jsxs)(v.A,{open:!!ze,onClose:()=>Te(null),children:[(0,W.jsx)(A.A,{children:"Share link"}),(0,W.jsx)(j.A,{children:(0,W.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(i.A,{fullWidth:!0,value:`${window.location.origin}/rooms/${ze||""}`,InputProps:{readOnly:!0}}),(0,W.jsx)(g.A,{onClick:()=>{var e;const t=`${window.location.origin}/rooms/${ze}`;null===(e=navigator.clipboard)||void 0===e||e.writeText(t).then((()=>{})).catch((e=>console.error("Copy failed",e)))},children:"Copy"})]})}),(0,W.jsx)(f.A,{children:(0,W.jsx)(g.A,{onClick:()=>Te(null),children:"Close"})})]}),(0,W.jsxs)(v.A,{open:!!Re,onClose:()=>Oe(null),children:[(0,W.jsx)(A.A,{children:"Leave room"}),(0,W.jsx)(j.A,{children:(0,W.jsx)(a.A,{children:"Are you sure you want to leave this room?"})}),(0,W.jsxs)(f.A,{children:[(0,W.jsx)(g.A,{onClick:()=>Oe(null),children:"Cancel"}),(0,W.jsx)(g.A,{variant:"contained",color:"error",onClick:async()=>{try{const n=Re;try{const e=await Promise.resolve().then(r.bind(r,75267)),o=await e.leaveRoom(t.token,n);o&&"boolean"===typeof o.removed?o.removed?Be({open:!0,message:"Left room"}):Be({open:!0,message:"Room removed from your lists"}):Be({open:!0,message:"Left room"})}catch(e){console.error("Leave room failed",e),null!==e&&void 0!==e&&e.message&&e.message.toLowerCase().includes("owner")?Be({open:!0,message:"You must transfer ownership before leaving this room."}):Be({open:!0,message:"Failed to leave room: "+((null===e||void 0===e?void 0:e.message)||e)})}}catch(e){console.error("Leave room failed",e),null!==e&&void 0!==e&&e.message&&e.message.toLowerCase().includes("owner")?Be({open:!0,message:"You must transfer ownership before leaving this room."}):Be({open:!0,message:"Failed to leave room: "+((null===e||void 0===e?void 0:e.message)||e)})}finally{Oe(null),await Nt()}},children:"Leave"})]})]}),(0,W.jsxs)(v.A,{open:!!Ne,onClose:()=>Le(null),children:[(0,W.jsx)(A.A,{children:"Archive room"}),(0,W.jsx)(j.A,{children:(0,W.jsx)(a.A,{children:"Are you sure you want to archive this room? Archiving hides the room from normal lists but preserves data. You can unarchive later."})}),(0,W.jsxs)(f.A,{children:[(0,W.jsx)(g.A,{onClick:()=>Le(null),children:"Cancel"}),(0,W.jsx)(g.A,{variant:"contained",color:"error",onClick:async()=>{try{const e=Ne;await(0,M.updateRoom)(t.token,e,{archived:!0}),Be({open:!0,message:"Room archived"})}catch(e){console.error("Archive room failed",e),Be({open:!0,message:"Failed to archive room: "+((null===e||void 0===e?void 0:e.message)||e)})}finally{Le(null),await Nt()}},children:"Archive"})]})]}),(0,W.jsxs)(v.A,{open:!!_e,onClose:()=>Ee(null),children:[(0,W.jsx)(A.A,{children:"Unarchive room"}),(0,W.jsx)(j.A,{children:(0,W.jsx)(a.A,{children:"Are you sure you want to unarchive this room? This will return the room to active lists."})}),(0,W.jsxs)(f.A,{children:[(0,W.jsx)(g.A,{onClick:()=>Ee(null),children:"Cancel"}),(0,W.jsx)(g.A,{variant:"contained",color:"primary",onClick:async()=>{try{const e=_e;await(0,M.updateRoom)(t.token,e,{archived:!1}),Be({open:!0,message:"Room unarchived"})}catch(e){console.error("Unarchive room failed",e),Be({open:!0,message:"Failed to unarchive room: "+((null===e||void 0===e?void 0:e.message)||e)})}finally{Ee(null),await Nt()}},children:"Unarchive"})]})]}),(0,W.jsxs)(v.A,{open:!!$e,onClose:()=>{De(null),Ke("")},children:[(0,W.jsx)(A.A,{children:"Permanently delete room"}),(0,W.jsxs)(j.A,{children:[(0,W.jsx)(a.A,{color:"error",sx:{mb:1},children:"This action is irreversible. Deleting a room will permanently remove it and ALL its data for every user."}),(0,W.jsxs)(a.A,{sx:{mb:1},children:["To confirm, type ",(0,W.jsx)("strong",{children:"DELETE"})," in the box below."]}),(0,W.jsx)(i.A,{fullWidth:!0,value:Fe,onChange:e=>Ke(e.target.value),placeholder:"Type DELETE to confirm"})]}),(0,W.jsxs)(f.A,{children:[(0,W.jsx)(g.A,{onClick:()=>{De(null),Ke("")},children:"Cancel"}),(0,W.jsx)(g.A,{variant:"contained",color:"error",disabled:"DELETE"!==Fe,onClick:async()=>{try{const e=$e,n=await Promise.resolve().then(r.bind(r,75267));await n.deleteRoom(t.token,e),Be({open:!0,message:"Room permanently deleted"})}catch(e){console.error("Permanent delete failed",e),Be({open:!0,message:"Failed to delete room: "+((null===e||void 0===e?void 0:e.message)||e)})}finally{De(null),Ke(""),await Nt()}},children:"Delete permanently"})]})]}),(0,W.jsxs)(o.A,{children:[(0,W.jsx)(I.A,{open:We.open,message:We.message,autoHideDuration:4e3,onClose:()=>Be({open:!1,message:""})}),(0,W.jsx)(I.A,{open:Ie.open,message:Ie.message,autoHideDuration:3500,onClose:()=>Pe({open:!1,message:""})})]})]})}}}]);
//# sourceMappingURL=110.dda9b9f7.chunk.js.map